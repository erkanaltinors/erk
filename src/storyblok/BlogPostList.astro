---
import { storyblokEditable, useStoryblokApi } from "@storyblok/astro";

const storyblokApi = useStoryblokApi();

const { data } = await storyblokApi.get("cdn/stories", {
 version: import.meta.env.DEV ? "draft" : "published",
 content_type: "blogPost",
});

const posts = data.stories.map((story: any) => {
 return {
  title: story.content.title,
  description: story.content.description,
  slug: story.full_slug,
  date: story.published_at
   ? new Date(story.published_at).toLocaleString("en", {
      day: "2-digit",
      month: "short",
      year: "numeric",
     })
   : null,
 };
});

const { blok } = Astro.props;
---

<section class="py-10" {...storyblokEditable(blok)}>
 <div class="container max-w-[800px]">
  <h2 class="blue-pill-border relative z-10 mb-5 inline-block text-3xl md:text-4xl">Posts</h2>
 </div>
 <div class="container max-w-[800px]">
  <div class="grid grid-cols-1 gap-4">
   {
    posts.map((post: any) => (
     <div class="col-span-1">
      <a
       href={post.slug}
       class="group box-border block h-full w-full rounded-sm p-2 transition hover:bg-slate-950 hover:text-white focus:outline-none"
      >
       <div class="flex justify-between">
        <p class="mt-0 font-semibold">{post.title}</p>
        <div>
         <p class="m-0 text-nowrap rounded-sm px-2 text-sm group-hover:bg-gray-100 group-hover:text-black">{post.date}</p>
        </div>
       </div>
       <div>
        <p class="m-0  text-base">{post.description}</p>
       </div>
      </a>
     </div>
    ))
   }
  </div>
 </div>
</section>
